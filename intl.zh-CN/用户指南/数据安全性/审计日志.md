# 审计日志 {#concept_dqn_qnr_l2b .concept}

云数据库MongoDB审计日志记录了您对数据库执行的所有操作。通过审计日志记录，您可以对数据库进行故障分析、行为分析、安全审计等操作，有效帮助您获取数据的执行情况。

## 使用前须知 {#section_vc4_4sh_y2b .section}

-   副本集实例和分片集群实例支持审计日志，单节点实例暂不支持该功能。
-   副本集实例可以设置审计的数据库操作类型。
-   分片集群实例暂不支持您自行设置审计的数据库操作类型。开启审计日志时，系统自动将admin，slow，query，insert，update，delete数据库操作作为审计项。
-   开启审计日志后，云数据库MongoDB默认保存30天的审计数据。
-   开启和关闭审计日志只能通过控制台操作。详情请参见[开启审计日志](#section_yqc_1th_y2b)和[关闭审计日志](#section_gwp_bd3_y2b)。
-   查询审计日志可以通过控制台或者[API](../../../../../intl.zh-CN/API参考/安全管理/DescribeAuditRecords.md#)来完成。

## 开启审计日志 {#section_yqc_1th_y2b .section}

1.  登录[MongoDB管理控制台](https://mongodb.console.aliyun.com/#/mongodb/list)。
2.  在页面左上角，选择实例所在的地域。
3.  根据实例类型，在左侧导航栏单击**副本集实例列表**或**分片集群实例列表**。
4.  找到目标实例，单击实例ID。
5.  在左侧导航栏，选择**数据安全性** \> **审计日志**。
6.  单击**开启审计**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/6736/154762043110389_zh-CN.png)

    **说明：** 开启审计日志时，CloudDBA索引推荐功能将同步开启。关于CloudDBA索引推荐，请参见[索引推荐](intl.zh-CN/用户指南/CloudDBA/索引推荐.md#)。

7.  单击**确定**。

## 查询和下载审计日志 {#section_q3c_n43_y2b .section}

1.  登录[MongoDB管理控制台](https://mongodb.console.aliyun.com/#/mongodb/list)。
2.  在页面左上角，选择实例所在的地域。
3.  根据实例类型，在左侧导航栏单击**副本集实例列表**或**分片集群实例列表**。
4.  找到目标实例，单击实例ID。
5.  在左侧导航栏，选择**数据安全性** \> **审计日志**。
6.  您可以查询、导出以及下载审计日志。
    -   查询：您可以输入数据库名字（**DB**）、数据库的登录账户名（**User**）、集合中的任何一个词或者记录（**Keyword**），选择或者输入起始时间、截止时间来按条件查询审计日志。

        |参数|说明|
        |:-|:-|
        |**数据库名**|若在查询时指定数据库的名字，则显示实例中指定数据库的审计日志。若查询时没有指定数据库名，则显示实例中所有数据库的审计日志。

|
        |**账号名**|若在查询时指定了登录数据库的账户名，则显示实例中指定账户的数据库的审计日志。若查询时没有指定登录数据库的账户名，则显示实例中所有数据库的审计日志。

|
        |**客户端IP**|若查询时指定了登录数据库的客户端IP，则显示实例中指定登录客户端IP的数据库的审计日志。若查询时没有指定登录数据库的客户端IP，则显示实例中所有数据库的审计日志。

|
        |**执行语句**|若查询时指定了Keyword，则显示实例中包含Keyword执行语句的数据库审计日志。若查询时没有指定Keyword，则显示实例中所有数据库的审计日志。

|
        |**消耗时间（微秒）**|数据库语句的执行时间。|
        |**返回记录数**|数据库语句执行后返回的记录数。|
        |**线程ID**|-|
        |**执行时间**|语句的执行时间。|

    -   导出文件：导出审计日志文件。

        **说明：** 如果满足过滤条件的语句总量超过100万条，则只会导出100万条。 导出语句的速度为900行／秒，100万条语句的导出时间预估为20分钟。

    -   文件列表：查看导出的审计日志文件列表，如[表 2](#table_sbk_ch3_y2b)所示。

        |参数|说明|
        |:-|:-|
        |**文件ID**|系统自动生成的审计日志文件ID。|
        |**文件状态**|审计日志文件有两种文件状态。        -   **未开始**：系统还未开始或者正在导出审计日志文件。
        -   **归档完成**：成功导出审计日志文件。

**说明：** 只有**归档完成**的文件才能被下载。

|
        |**审计日志起始时间**|审计日志的起始时间。|
        |**审计日志结束时间**|审计日志的结束时间。|
        |**下载地址**|单击**下载地址**，将审计日志下载至本地。|
        |**日志文件大小**|审计日志文件的大小。|


## 审计设置 {#section_wnl_fk3_y2b .section}

副本集实例在开启审计日志后，支持您自行设置审计数据库的操作类型。

1.  登录[MongoDB管理控制台](https://mongodb.console.aliyun.com/#/mongodb/list)。
2.  在页面左上角，选择实例所在的地域。
3.  在左侧导航栏单击**副本集实例列表**。
4.  找到目标实例，单击实例ID。
5.  在左侧导航栏，选择**数据安全性** \> **审计日志**。
6.  单击**审计设置**。
7.  在审计设置对话框中，勾选相应的复选框，设置需要审计的数据库操作类型。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/6736/154762043137323_zh-CN.png)

    您可以选择以下数据库操作。

    -   admin：运维操作
    -   slow：慢查询
    -   query：查询
    -   insert：插入
    -   update：更新
    -   delete：删除
    -   command：协议命令。例如，aggregate聚合方法等。
    **说明：** 

    -   在2018年7月份之前开启审计日志的实例，审计日志中默认审计操作类型有admin，slow，insert，update，delete，command。没有设置query查询操作，如有需要，可通过审计设置功能设置。
    -   2018年7月份之后开启审计日志的实例，审计日志中默认审计操作类型有admin，slow，query，insert，update，delete，command。
8.  单击**确定**。

## 关闭审计日志 {#section_gwp_bd3_y2b .section}

1.  登录[MongoDB管理控制台](https://mongodb.console.aliyun.com/#/mongodb/list)。
2.  在页面左上角，选择实例所在的地域。
3.  根据实例类型，在左侧导航栏单击**副本集实例列表**或**分片集群实例列表**。
4.  找到目标实例，单击实例ID。
5.  在左侧导航栏，选择**数据安全性** \> **审计日志**。
6.  单击**关闭审计**。

    **说明：** 

    -   关闭审计日志后，索引推荐功能会同时被关闭。
    -   关闭审计日志后，对日志的采集将会关闭，也无法对后继的数据库操作进行审计，且之前保存的审计日志也将清除。
7.  在关闭日志对话框中，单击**确定**。

