# 迁移可用区

您可以将实例迁移至同一地域内的其它可用区。迁移可用区后，实例的所有属性、规格配置和连接地址都不会改变。

## 前提条件

-   实例类型为MongoDB 4.2及以下版本的副本集实例或分片集群实例。
-   实例未开启透明数据加密TDE功能。
-   迁移的目标可用区和当前实例的可用区处于同一地域。
-   专有网络的实例在操作迁移可用区之前，请确保目标可用区已创建相应的虚拟交换机，如需创建请参见[创建虚拟交换机](https://help.aliyun.com/document_detail/65387.html#h2-url-1)。
-   实例不可具备公网连接地址，如果已申请了公网连接地址，请先释放。释放的操作流程请参见[释放公网连接地址](/cn.zh-CN/用户指南/管理网络连接/公网连接地址/释放公网连接地址.md)。

## 注意事项

-   专有网络的实例在迁移可用区时，不允许更换实例的专有网络。
-   迁移所需时间和网络、任务队列、数据量大小等多种因素有关，请在业务低峰期执行迁移可用区操作。
-   迁移可用区过程中会有30秒闪断，请确保应用程序具有重连机制。
-   迁移可用区会造成虚拟IP（VIP，如172.16.88.60）的变更。如果应用连接的是数据库的虚拟IP，则与数据库的连接会断开。

    **说明：** 建议使用ConnectionstringURI地址来连接实例以保障高可用性，副本集实例请参见[副本集实例连接说明]()，分片集群实例请参见[分片集群实例连接说明]()。


## 支持的迁移类型和场景

|支持的迁移类型|常见场景|
|:------|:---|
|从单可用区迁移至另一单可用区|将MongoDB实例迁移至ECS实例所属的可用区，同一可用区ECS实例和MongoDB实例通过内网连接拥有更低的网络延迟。|
|从单可用区迁移至多可用区|提高实例的容灾能力，实现跨机房容灾。 单可用区实例可以承受服务器和机架级别的故障，而多可用区实例可以承受机房级别的故障。例如将三节点副本集中的节点，分别部署在同一地域的三个不同的可用区，可承受更高级别的灾难。

**说明：** 关于多可用区副本集实例和分片集群实例的节点部署策略，请参见[副本集实例节点部署方案对比](/cn.zh-CN/用户指南/同城容灾解决方案/创建多可用区副本集实例.md)或[图 1](/cn.zh-CN/用户指南/同城容灾解决方案/创建多可用区分片集群实例.md)。 |
|从多可用区迁移至单可用区|满足特定功能的要求。|
|从多可用区迁移至多可用区|MongoDB实例升配时需要更多的资源，新的多可用区能够提供充足的空间。|

## 操作步骤

1.  登录[MongoDB管理控制台](https://mongodb.console.aliyun.com/)。

2.  在页面左上角，选择实例所在的资源组和地域。

3.  根据实例类型，在左侧导航栏，单击**副本集实例列表**或**分片集群实例列表**。

4.  找到目标实例，单击实例ID。

5.  在**基本信息**区域，单击**迁移可用区**。

    ![单击迁移可用区](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4446819951/p44911.png)

6.  根据实例的网络类型，在**将实例迁移至其他可用区**面板，配置对应的参数。

    -   网络类型为专有网络或处于专有网络和经典网络混访。

        ![专有网络迁移可用区](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1407423261/p94218.png)

        |参数|参数说明|
        |--|----|
        |**迁移至**|选择迁移的目标可用区。|
        |**请选择虚拟交换机**|选择迁移的虚拟交换机。|
        |**切换时间**|选择开始迁移可用区的时间。        -   **立即切换**：参数配置完成后，系统立即开始迁移可用区任务。
        -   **可维护时间内进行切换**：设置实例开始迁移可用区的时间，您可以查看当前设置的时间段，也可以根据业务需求，选择以下任意一种方法修改可维护时间段：
            -   单击**可维护时间内进行切换**右侧的**编辑**设置切换时间。
            -   在**规格信息**区域，单击**可维护时间段**右侧的**编辑**设置切换时间，设置方法请参见[设置可维护时间段](/cn.zh-CN/用户指南/实例管理/设置可维护时间段.md)。 |

    -   网络类型为经典网络。

        ![经典网络迁移可用区](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4446819951/p94219.png)

        |参数|参数说明|
        |--|----|
        |**迁移至**|选择迁移的目标可用区。|
        |**切换时间**|选择开始迁移可用区的时间。        -   **立即切换**：参数配置完成后，系统立即开始迁移可用区任务。
        -   **可维护时间内进行切换**：设置实例开始迁移可用区的时间，您可以查看当前设置的时间段，也可以根据业务需求，选择以下任意一种方法修改可维护时间段：
            -   单击**可维护时间内进行切换**右侧的**编辑**设置切换时间。
            -   在**规格信息**区域，单击**可维护时间段**右侧的**编辑**设置切换时间，设置方法请参见[设置可维护时间段](/cn.zh-CN/用户指南/实例管理/设置可维护时间段.md)。 |

7.  仔细阅读提示信息后勾选复选框。

8.  单击**确定**。


