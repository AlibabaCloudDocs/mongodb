# 变更分片集群实例配置

云数据库MongoDB版分片集群实例支持变更配置功能，当您购买的实例无法满足您的业务性能要求或当前实例配置过高，您可以对当前实例进行变配操作，使当前实例的配置与您的业务需求更加匹配。

## 约束

-   分片集群实例不支持变更实例类型和存储引擎。
-   对节点进行不同操作的约束信息如下表所示：

    |操作|约束信息|
    |--|----|
    |添加Shard节点|您需要确保新增节点的配置均等于或高于当前实例中最高配置的shard节点，例如当前实例中最高配置的Shard节点的存储空间为10 GB，则需要将新增节点的存储空间配置为10 GB及以上。|
    |变更Shard节点|您需要确保以下事项：    -   存储空间大于当前Shard节点已占用的存储空间。
    -   只读节点数需要等于或高于当前实例中最高规格Shard节点只读节点数的个数。
    -   在同一次变配配置中，如果您需要降低当前Shard节点的**规格**，则不能增加当前实例的**只读节点数**个数。 |
    |释放Mongos节点|您需要确保Shard节点数量为3个及以上。|
    |释放Shard节点|您需要确保Mongos节点数量为3个及以上。|


## 计费规则

详情请参见[变更配置费用说明](/cn.zh-CN/产品定价/变更配置费用说明.md)。

## 影响

-   变配过程中，可能会连接切换操作带来1~2次30秒内的闪断，您可以按需设置变更生效时间，避免业务影响。如果仅变更**存储空间**，则不会发生该现象。
-   变更配置的完成时间和网络、任务队列、数据量大小等多种因素有关，建议您在业务低峰期执行变配操作，并确保您的应用有自动重连机制。
-   如果您的数据库小版本过期或者不在维护列表内，系统会默认将您的数据库小版本升级至最新版，以保证提供更出色的性能和稳定性。
-   释放Shard节点前，您需要确保剩余Shard节点完全可以分担释放节点的数据，否则，执行释放操作后，实例状态将会一直为**删除节点中**，影响对实例进行与数据库、账号、网络等相关的操作。

## 添加节点

1.  登录[MongoDB管理控制台](https://mongodb.console.aliyun.com/)。

2.  在页面左上角，选择实例所在的资源组和地域。

3.  在左侧导航栏，单击**分片集群实例列表**。

4.  找到目标实例，单击实例ID。

5.  在**基本信息**页面，完成添加节点的操作。

    -   添加Mongos节点
        1.  在**Mongos列表**区域，单击**添加Mongos**。
        2.  在**添加Mongos**页面，选择Mongos节点的**规格**。
    -   添加Shard节点

        **说明：** 新增节点的配置均需要等于或高于当前实例中最高配置的shard节点，例如当前实例中最高配置的Shard节点的存储空间为10 GB，则新增节点的存储空间需要配置为10 GB及以上。

        1.  在**Shard列表**区域，单击**添加Shard**。
        2.  在**添加Shard**页面，选择Shard节点的**规格**、**存储空间**和**只读节点数**。
6.  单击**去支付**。

7.  在**支付**页面，根据提示完成支付流程。

    执行添加节点操作时，实例状态为**变配中**，当实例状态变更为**运行中**，说明节点添加成功。


## 变更现有节点配置

关于详细的实例规格信息，请参见[实例规格表](/cn.zh-CN/产品简介/实例规格表.md)。

1.  登录[MongoDB管理控制台](https://mongodb.console.aliyun.com/)。

2.  在页面左上角，选择实例所在的资源组和地域。

3.  在左侧导航栏，单击**分片集群实例列表**。

4.  找到目标实例，单击实例ID。

5.  在**基本信息**页面，完成变更节点配置的操作。

    -   变更Mongos节点配置
        1.  在**Mongos列表**区域，单击目标Mongos节点所在行**操作**列的![三个点](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7156819951/p13851.png)，并选择**变更配置**。

            ![变更Mongos节点配置](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8626260261/p21057.png)

        2.  在**变配配置**页面，设置以下参数。

            |参数|说明|
            |--|--|
            |**规格**|选择变配的规格。|
            |**切换时间**|选择执行变配操作的时间。            -   **立即切换**：变配配置完成后，系统立即执行变配操作。
            -   **可维护时间内进行切换**：在可维护时间段内系统执行变配操作，您可以查看当前设置的运维时间段，也可以根据业务需求，选择以下任意一种方法变更运维时间：
                -   单击**可维护时间内进行切换**右侧的**编辑**设置切换时间。
                -   在**规格信息**区域，单击**可维护时间段**右侧的**编辑**设置切换时间，设置方法请参见[设置可维护时间段](/cn.zh-CN/用户指南/实例管理/设置可维护时间段.md)。 |

    -   变更Shard节点配置
        1.  在**Shard列表**区域，单击目标Shard节点所在行**操作**列的![三个点](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7156819951/p13851.png)，并选择**变更配置**。

            ![变更Shard节点配置](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8626260261/p21056.png)

        2.  在**变配配置**页面，设置以下参数。

            |参数|说明|
            |--|--|
            |**规格**|选择变配的规格。|
            |**存储空间**|选择变配的存储空间。**说明：** 存储空间需要大于当前Shard节点的存储空间大小。 |
            |**只读节点数**|选择变配的只读节点数。**说明：**

            -   只读节点数需要等于或大于当前实例中最高规格Shard节点的只读节点数个数。
            -   在同一次变配配置中，如果您需要降低当前Shard节点的**规格**，则不能增加当前实例的**只读节点数**个数。 |
            |**切换时间**|选择执行变配操作的时间。            -   **立即切换**：变配配置完成后，系统立即执行变配操作。
            -   **可维护时间内进行切换**：在可维护时间段内系统执行变配操作，您可以查看当前设置的运维时间段，也可以根据业务需求，选择以下任意一种方法变更运维时间：
                -   单击**可维护时间内进行切换**右侧的**编辑**设置切换时间。
                -   在**规格信息**区域，单击**可维护时间段**右侧的**编辑**设置切换时间，设置方法请参见[设置可维护时间段](/cn.zh-CN/用户指南/实例管理/设置可维护时间段.md)。 |

    执行变配操作时，实例状态为**变配中**，当实例状态变更为**运行中**，说明变配操作成功。


## 释放节点

1.  登录[MongoDB管理控制台](https://mongodb.console.aliyun.com/)。

2.  在页面左上角，选择实例所在的资源组和地域。

3.  在左侧导航栏，单击**分片集群实例列表**。

4.  找到目标实例，单击实例ID。

5.  根据待释放的节点类型，选择下述操作步骤：

    -   释放Mongos节点

        在**Mongos列表**区域，单击目标Mongos节点所在行**操作**列的![更多](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7156819951/p13851.png)，并选择**释放**。

        ![释放Mongos节点](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6724640261/p271817.png)

    -   释放Shard节点

        **说明：** 释放Shard节点前，您需要确保剩余Shard节点完全可以分担释放节点的数据，否则，执行释放操作后，实例状态将会一直为**删除节点中**，影响对实例进行与数据库、账号、网络等相关的操作。

        在**Shard列表**区域，单击目标Shard节点所在行**操作**列的![更多](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7156819951/p13851.png)，并选择**释放**。

        ![释放Shard节点](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5334640261/p271818.png)

6.  在弹出的**释放节点**提示框中，单击**确定**。

    执行释放节点操作时，实例状态为**删除节点中**，当实例状态变更为**运行中**时，说明节点释放成功。


## 更多信息

[解决因磁盘空间耗尽导致的锁定或无法写入问题](/cn.zh-CN/常见问题/性能和存储空间/MongoDB中磁盘空间耗尽导致无法写入问题.md)

