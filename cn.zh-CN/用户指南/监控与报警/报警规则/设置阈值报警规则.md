# 设置阈值报警规则

云数据库MongoDB支持为实例的重要监控项设置阈值报警规则。当监控项的值不在设置的阈值范围内时，系统会自动向你发出报警通知，提醒您数据异常，帮助您快速定位问题并进行处理。本文介绍在MongoDB控制台设置阈值报警规则的方法。

## 操作步骤

1.  登录[MongoDB管理控制台](https://mongodb.console.aliyun.com/)。

2.  在页面左上角，选择实例所在的资源组和地域。

3.  根据实例类型，在左侧导航栏单击**副本集实例列表**或**分片集群实例列表**。

4.  找到目标实例，单击实例ID。

5.  在左侧导航栏中，单击**报警规则**。

6.  单击页面左上角的**设置报警规则**。

    进入云监控控制台。

7.  在云监控控制台，为MongoDB实例设置阈值报警规则。

    1.  单击**阈值告警**页签。

    2.  单击页面左上角的**创建报警规则**。

    3.  在**创建报警规则**页面，设置以下参数。

        1.  关联资源

            ![关联资源](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0923281261/p275536.png)

            |参数|参数说明|
            |--|----|
            |**产品**|根据实例类型，选择**云数据库MongoDB版-单节点实例**、**云数据库MongoDB版-副本集**或**云数据库MongoDB版-分片集群**。|
            |**资源范围**|报警规则的作用范围。取值：            -   **全部资源**：表示该规则作用在用户名下对应产品的全部实例上。

示例：您设置了全部资源粒度的MongoDB CPU使用率大于80%报警，则只要用户名下有MongoDB CPU使用率大于80%，就会发送报警通知。资源范围选择全部资源时，报警的资源最多1000个，超过1000个可能会导致达到阈值不报警的问题，建议您使用应用分组按业务划分资源后再设置报警。

            -   **实例**：表示该规则只作用在某个具体实例上。

示例：您如果设置了实例粒度的主机CPU使用率大于80%报警，则当该实例CPU使用率大于80%时，会发送报警通知。 |
            |**地域**|选择实例所在地域。**说明：** 当**资源范围**为**实例**时配置该参数。 |
            |**实例**|选择实例ID。您也可以选择多个。**说明：** 当**资源范围**为**实例**时配置该参数。 |
            |**Mongos**|选择Mongos节点ID。**说明：** 当产品名称为**云数据库MongoDB版-分片集群**，且**资源范围**为**实例**时配置该参数。 |
            |**Shard**|选择Shard节点ID。**说明：** 当产品名称为**云数据库MongoDB版-分片集群**，且**资源范围**为**实例**时配置该参数。 |

        2.  设置报警规则

            ![设置报警规则](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1161591261/p277436.png)

            **说明：** 您可以通过单击**添加报警规则**设置多条报警规则，不同类型MongoDB实例支持的监控项不同，请分别参考以下内容设置：

            -   [云数据库MongoDB版-单节点实例](/cn.zh-CN/附录1 云服务监控项/数据库/NoSQL数据库/云数据库MongoDB版-单节点实例.md)
            -   [云数据库MongoDB版-副本集](/cn.zh-CN/附录1 云服务监控项/数据库/NoSQL数据库/云数据库MongoDB版-副本集.md)
            -   [云数据库MongoDB版-分片集群](/cn.zh-CN/附录1 云服务监控项/数据库/NoSQL数据库/云数据库MongoDB版-分片集群.md)
            |参数|参数说明|
            |--|----|
            |**规则名称**|输入报警规则的名称。|
            |**规则描述**|报警规则的主体，定义在监控数据满足指定条件时，触发报警规则。示例：CPU使用率5分钟平均值\>=90%，持续3个周期，则报警服务5分钟检查一次数据是否满足平均值\>=90%，只检测3次。 |
            |**role**|选择报警规则的角色。取值为**任意role**、**Primary**、**Secondary**、**Readonly**或**Hidden**。**说明：**

            -   单节点实例不需要选择角色。
            -   副本集和分片集群实例**资源范围**为**全部资源**时，固定为**任意role**。 |
            |**通道沉默周期**|报警发生后如果未恢复正常，重复发送报警通知的间隔时间。|
            |**生效时间**|报警规则的生效时间，报警规则只在生效时间内才会检查监控数据是否需要报警。|

        3.  通知方式

            ![通知方式](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7801102261/p277438.png)

            |参数|参数说明|
            |--|----|
            |**通知对象**|选择发送报警的联系人组。您也可以单击**快速创建联系人组**创建，创建方法请参见[创建报警联系组](/cn.zh-CN/报警服务/报警联系人/创建报警联系人或报警联系组.md)|
            |**报警级别**|            -   电话+短信+邮件+钉钉机器人
            -   短信+邮件+钉钉机器人
            -   邮件+钉钉机器人 |
            |**弹性伸缩**|如果您勾选了**弹性伸缩**，当报警发生时，会触发相应的伸缩规则。您需要设置弹性伸缩的**地域**、**弹性伸缩组**和**弹性伸缩规则**。            -   创建弹性伸缩组的操作方法，请参见[创建伸缩组](/cn.zh-CN/伸缩组/伸缩组/创建伸缩组.md)。
            -   创建弹性伸缩规则的操作方法，请参见[创建伸缩规则](/cn.zh-CN/伸缩组/伸缩规则/创建伸缩规则.md)。 |
            |**日志服务**|如果您勾选**日志服务**，当报警发生时，会将报警信息写入日志服务。您需要设置日志服务的**地域**、**Project**和**Logstore**。创建Project和Logstore的操作方法，请参见[日志服务快速入门](/cn.zh-CN/.md)。 |
            |**邮件备注**|自定义报警邮件补充信息。填写邮件备注后，发送报警的邮件通知中会附带您的备注。|
            |**报警回调**|填写公网可访问的URL，云监控会将报警信息通过POST请求推送到该地址，目前仅支持HTTP协议。|

8.  设置完成后，单击**确认**。

9.  创建完成后，您可以在云监控控制台报警规则列表中查看，您也可以在[MongoDB管理控制台](https://mongodb.console.aliyun.com/)报警规则列表中查看。


## 相关文档

-   您也可以在云监控控制台设置阈值和事件报警规则，设置方法请参见[创建阈值报警规则](/cn.zh-CN/报警服务/报警规则/创建阈值报警规则.md)和[创建事件报警规则](/cn.zh-CN/报警服务/报警规则/创建事件报警规则.md)。
-   报警规则设置成功后，您可以在云监控控制台管理报警规则，具体请参见：
    -   [修改报警规则](/cn.zh-CN/报警服务/报警规则/修改报警规则.md)
    -   [禁用报警规则](/cn.zh-CN/报警服务/报警规则/禁用报警规则.md)
    -   [删除报警规则](/cn.zh-CN/报警服务/报警规则/删除报警规则.md)
    -   [查看指定报警规则的报警历史](/cn.zh-CN/报警服务/报警规则/查看指定报警规则的报警历史.md)

