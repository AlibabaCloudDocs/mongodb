# 分片集群实例设置主备切换

MongoDB分片集群实例的每个Shard节点都默认含有三个节点，当某个节点发生故障时，云数据库MongoDB的高可用系统会自动触发主备切换，保障整体的可用性。同时您也可以在日常容灾演练等场景中，手动触发云数据库MongoDB主备切换功能。

## 主备切换注意事项

分片集群实例Shard节点中的Primary节点及Secondary节点对外提供访问地址，Hidden节点作为日常备节点保障高可用。通过控制台或[API](/cn.zh-CN/API参考/实例管理/SwitchDBInstanceHA.md)操作MongoDB分片集群实例的主备切换后，系统将实现Shard节点中Primary节点和Secondary节点的角色互换。

**说明：**

-   云数据库MongoDB主备切换操作只支持副本集实例和分片集群实例，单节点实例因架构因素，不支持主备切换。
-   分片集群实例的主备切换要求进行切换的Shard节点处于正常运行状态。
-   触发主备切换后，会产生1次30秒内的连接闪断，请在业务低峰期操作并确保应用具备重连机制。

## 操作步骤

1.  登录[MongoDB管理控制台](https://mongodb.console.aliyun.com/)。

2.  在页面左上角，选择实例所在的资源组和地域。

3.  在左侧导航栏，单击**分片集群实例列表**。

4.  找到目标实例，单击实例ID。

5.  在**Shard列表**区域框，找到需要切换的Shard节点，单击**![](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/7156819951/p13851.png)** \> **主备切换**。

    ![](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/9091715061/p13849.png)

    每个Shard节点都单独提供主备切换入口，主备切换仅对当前操作的Shard节点有效，不影响集群下其他Shard节点。

6.  在弹出的**主备切换**对话框中，选择**生效时间**并单击**确定**。

    **说明：** **主备切换**支持两种**生效时间**：

    -   **立即生效**：系统会立即执行主备切换。
    -   **可运维时间内生效**：系统会在指定的可维护时间内执行主备切换。关于如何设置可维护时间，请参见[设置可维护时间段](/cn.zh-CN/用户指南/实例管理/设置可维护时间段.md)。
7.  实例状态变更为**主备切换中**，切换成功后转变为**运行中**。

    **说明：** 约1分钟左右，Shard节点会完成主备切换。MongoDB分片集群实例中其他Shard节点如有主备切换需求，可重复上述步骤操作 。


## 相关问题

[为什么高可用系统会触发主备切换](/cn.zh-CN/常见问题/热点问题/为什么高可用系统会触发主备切换.md)

